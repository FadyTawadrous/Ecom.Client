<nav class="navbar">
  <div class="nav-container">

    <a routerLink="/" class="logo-link">
      <div class="logo-wrapper">
        <div class="logo-icon-box">
          <img src="assets/ecom-icon.png" alt="Logo" class="logo-img" onerror="this.style.display='none'">

          @if (true) {
          <mat-icon class="fallback-icon">spa</mat-icon>
          }
        </div>
      </div>
      <span class="brand-text">Bazaar</span>
    </a>

    <div class="nav-links">
      <a routerLink="/shopping" routerLinkActive="active" class="nav-item">
        <span>Shop</span>
      </a>
    </div>

    <div class="spacer"></div>

    <div class="nav-actions">

      @if (isAuthenticated()) {

      <button mat-icon-button routerLink="/wishlist" class="action-btn" matTooltip="Wishlist">
        <mat-icon [matBadge]="totalWishlistItems()" [matBadgeHidden]="totalWishlistItems() === 0" matBadgeColor="warn">
          favorite_border
        </mat-icon>
      </button>

      <button mat-icon-button routerLink="/cart" class="action-btn" matTooltip="Cart">
        <mat-icon [matBadge]="totalCartItems()" [matBadgeHidden]="totalCartItems() === 0" matBadgeColor="warn">
          shopping_cart
        </mat-icon>
      </button>

      <button mat-button [matMenuTriggerFor]="userMenu" class="user-btn">
        @if (currentUser()?.profileImageUrl) {
        <img [src]="currentUser()?.profileImageUrl" class="user-avatar" alt="User">
        } @else {
        <div class="user-avatar-placeholder">
          {{ getInitials(currentUser()?.displayName) }}
        </div>
        }
        <span class="user-name">{{ currentUser()?.displayName }}</span>
        <mat-icon class="dropdown-icon">expand_more</mat-icon>
      </button>

      <mat-menu #userMenu="matMenu" class="earthy-menu">
        <div class="menu-header">
          <p class="menu-name">{{ currentUser()?.displayName }}</p>
          <p class="menu-email">{{ currentUser()?.email }}</p>
        </div>

        <mat-divider></mat-divider>

        <button mat-menu-item routerLink="/account/profile">
          <mat-icon>person_outline</mat-icon>
          <span>My Profile</span>
        </button>
        <button mat-menu-item routerLink="/orders">
          <mat-icon>shopping_bag</mat-icon>
          <span>My Orders</span>
        </button>
        <button mat-menu-item routerLink="/account/addresses">
          <mat-icon>place</mat-icon>
          <span>Addresses</span>
        </button>

        @if (isAdmin()) {
        <mat-divider></mat-divider>
        <button mat-menu-item routerLink="/admin/dashboard">
          <mat-icon>dashboard</mat-icon>
          <span>Admin Dashboard</span>
        </button>
        }

        <mat-divider></mat-divider>

        <button mat-menu-item (click)="logout()" class="logout-item">
          <mat-icon>logout</mat-icon>
          <span>Sign Out</span>
        </button>
      </mat-menu>

      } @else {
      <div class="auth-buttons">
        <a routerLink="/account/login" mat-button class="login-btn">Sign In</a>
        <a routerLink="/account/register" mat-flat-button class="register-btn">Register</a>
      </div>
      }
    </div>
  </div>
</nav>