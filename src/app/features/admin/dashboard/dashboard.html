<div class="dashboard-page">

  <div class="dashboard-header">
    <div class="header-text">
      <h2 class="page-title">Admin Dashboard</h2>
    </div>

    <button mat-flat-button class="refresh-btn" (click)="loadStats()">
      <mat-icon>refresh</mat-icon> Refresh
    </button>
  </div>

  @if (loading) {
  <div class="state-container">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Loading dashboard...</p>
  </div>
  }

  @if (error && !loading) {
  <div class="error-banner">
    <mat-icon>error_outline</mat-icon>
    <span>{{ error }}</span>
  </div>
  }

  @if (stats && !loading) {

  <div class="stats-grid">

    <mat-card class="stat-card">
      <div class="stat-content">
        <span class="stat-label">Total Users</span>
        <span class="stat-value">{{ stats.totalUsers }}</span>
        <span class="stat-hint">Registered users</span>
      </div>
      <div class="stat-icon">
        <mat-icon>group</mat-icon>
      </div>
    </mat-card>

    <mat-card class="stat-card">
      <div class="stat-content">
        <span class="stat-label">Total Orders</span>
        <span class="stat-value">{{ stats.totalOrders }}</span>
        <span class="stat-hint">Lifetime orders</span>
      </div>
      <div class="stat-icon">
        <mat-icon>receipt_long</mat-icon>
      </div>
    </mat-card>

    <mat-card class="stat-card">
      <div class="stat-content">
        <span class="stat-label">Total Products</span>
        <span class="stat-value">{{ stats.totalProducts }}</span>
        <span class="stat-hint">Active SKUs</span>
      </div>
      <div class="stat-icon">
        <mat-icon>inventory_2</mat-icon>
      </div>
    </mat-card>

    <mat-card class="stat-card highlight">
      <div class="stat-content">
        <span class="stat-label">Total Revenue</span>
        <span class="stat-value">{{ stats.totalRevenue | currency }}</span>
        <span class="stat-hint">Completed payments</span>
      </div>
      <div class="stat-icon">
        <mat-icon>attach_money</mat-icon>
      </div>
    </mat-card>

    <mat-card class="stat-card">
      <div class="stat-content">
        <span class="stat-label">Orders Today</span>
        <span class="stat-value">{{ stats.todayOrders }}</span>
        <span class="stat-hint">Since midnight UTC</span>
      </div>
      <div class="stat-icon">
        <mat-icon>today</mat-icon>
      </div>
    </mat-card>

  </div>

  <div class="dashboard-split">

    <mat-card class="chart-card">
      <div class="card-header">
        <h3>Orders Trend</h3>
        <p>Last 7 Days Activity</p>
      </div>

      @if (stats.ordersLast7Days?.length;) {
      <div class="chart-container">
        @for (d of stats.ordersLast7Days; track d) {
        <div class="bar-group">
          <div class="bar" [style.height.px]="getBarHeight(d)">
            <span class="bar-tooltip">{{ d.ordersCount }} Orders</span>
          </div>
          <span class="bar-label">{{ formatDay(d) }}</span>
        </div>
        }
      </div>
      }
      <ng-template #noChart>
        <div class="empty-chart">
          <p>No order data available for the last 7 days.</p>
        </div>
      </ng-template>
    </mat-card>

    <mat-card class="recent-orders-card">
      <div class="card-header">
        <h3>Recent Orders</h3>
        <p>Latest 5 transactions</p>
      </div>

      @if (stats.recentOrders?.length;) {
      <div class="orders-list">
        @for (o of stats.recentOrders; track o.orderId) {
        <div class="order-item">
          <div class="order-info">
            <div class="order-id-row">
              <span class="order-id">#{{ o.orderId }}</span>
              <span class="order-user">{{ o.userName || 'Unknown' }}</span>
            </div>
            <span class="order-date">{{ formatOrderDate(o) }}</span>
          </div>

          <div class="order-meta">
            <span class="order-total">{{ o.total | currency }}</span>
            <span class="status-badge" [ngClass]="o.status.toLowerCase()">
              {{ o.status }}
            </span>
          </div>
        </div>
        }
      </div>
      }
      <ng-template #noRecent>
        <div class="empty-list">
          <p>No recent orders yet.</p>
        </div>
      </ng-template>
    </mat-card>

  </div>

  }
</div>