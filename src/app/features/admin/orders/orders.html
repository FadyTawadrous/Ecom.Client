<div class="admin-page">

  <div class="page-header">
    <h2 class="page-title">Orders Management</h2>
    <p class="page-subtitle">Track, update, and manage customer orders.</p>
  </div>

  <div class="orders-grid">

    <div class="main-panel">

      <mat-card class="filter-card">
        <div class="filter-row">

          <mat-form-field appearance="outline" class="clean-field">
            <mat-label>Order Number</mat-label>
            <input matInput [(ngModel)]="filters.orderNumber" (input)="applyFilters()">
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline" class="clean-field">
            <mat-label>Status</mat-label>
            <mat-select [(ngModel)]="filters.status" (selectionChange)="applyFilters()">
              <mat-option value="">All Status</mat-option>
              @for (s of statusList; track s) {
              <mat-option [value]="s">{{ s }}</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <button mat-stroked-button class="reset-btn" (click)="resetFilters()">
            Reset
          </button>

        </div>
      </mat-card>

      <mat-card class="table-card">

        @if (loading) {
        <div class="loading-state">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Loading orders...</p>
        </div>
        } @else {
        <div class="table-container">
          <table class="custom-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Total</th>
                <th>Status</th>
                <th class="text-right">Actions</th>
              </tr>
            </thead>
            <tbody>
              @for (o of orders; track o.id) {
              <tr [class.selected]="selectedOrder?.id === o.id" (click)="viewOrder(o.id)">
                <td class="font-medium">#{{ o.id }}</td>
                <td class="font-medium">{{ o.totalAmount | currency }}</td>
                <td>
                  <span class="status-badge" [ngClass]="o.status.toLowerCase()">
                    {{ o.status }}
                  </span>
                </td>
                <td class="actions-cell">

                  <div class="status-select-wrapper" (click)="$event.stopPropagation()">
                    <select (change)="onStatusChange(o, $event)" class="native-select">
                      <option value="" disabled selected>Update Status</option>
                      @for (s of statusList; track s) {
                      <option [value]="s">{{ s }}</option>
                      }
                    </select>
                  </div>

                  <button mat-icon-button class="cancel-btn" (click)="cancelOrder(o.id); $event.stopPropagation()"
                    matTooltip="Cancel Order">
                    <mat-icon>cancel</mat-icon>
                  </button>

                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
        }

      </mat-card>
    </div>

    <mat-card class="details-card">
      <div class="card-header">
        <h3>Order Details</h3>
      </div>

      <div class="details-body">

        @if (!selectedOrder) {
        <div class="empty-selection">
          <mat-icon>touch_app</mat-icon>
          <p>Select an order to view full details.</p>
        </div>
        } @else {
        <div class="order-summary">

          <div class="summary-row">
            <span class="label">Order ID</span>
            <span class="value">#{{ selectedOrder.id }}</span>
          </div>

          <div class="summary-row">
            <span class="label">Status</span>
            <span class="status-badge" [ngClass]="selectedOrder.status.toLowerCase()">
              {{ selectedOrder.status }}
            </span>
          </div>

          <div class="summary-row">
            <span class="label">Total Amount</span>
            <span class="value price">{{ selectedOrder.totalAmount | currency }}</span>
          </div>

          <mat-divider class="my-4"></mat-divider>

          <h4 class="items-title">Items ({{ selectedOrder.items?.length || 0 }})</h4>

          <div class="items-list">
            @for (item of selectedOrder.items; track item.productId) {
            <div class="order-item">
              <div class="item-info">
                <span class="item-name">{{ item.productTitle }}</span>
                <span class="item-qty">Qty: {{ item.quantity }}</span>
              </div>
              <span class="item-price">{{ item.totalPrice | currency }}</span>
            </div>
            }
          </div>

        </div>
        }

      </div>
    </mat-card>

  </div>
</div>